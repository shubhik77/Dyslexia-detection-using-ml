<!DOCTYPE html>
<html>

<head>
    <title>quiz page</title>
    <style>
        body {
            font-family: 'Times New Roman', Times, serif;
        }

        header {
            height: 70px;
            background-color: #73b7c9dd;
            margin-top: 5px;
            text-align: right;
            position: static;
        }

        span {
            background-color: #e9eef0;
            font-weight: 100;
            font-size: 30px;

            opacity: 0.7;
            padding: 10px;
            transition: cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.5s;
        }

        span:hover {
            background-color: #73b7c9dd;
            border: 0px;
        }

        .parallax1 {
            background-image: url("quiz.jpeg");
            min-height: 200px;
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            padding: 5em;
        }

        .main {
            background-color: #73b7c9dd;
            padding: 10px;
        }

        .question {
            background-color: #e9eef0;
            font-size: 25px;
            font-weight: 400;
            padding: 2em;
        }

        #question {
            background-color: #7eb1be;
            font-size: 30px;
            text-align: center;
            padding: 10px;
        }

        #button {
            background-color: #73b7c9dd;
            font-size: 50px;
            text-align: center;
        }

        .footer {
            height: 55px;
            background-color: #73b7c9dd;
            padding: 1em;
            font-size: 15px;
            text-align: center;
            position: static;
            padding-bottom: 2em;
        }

        a:link {
            color: black;
            text-decoration-line: none;
        }

        a:visited {
            color: black;
            text-decoration-line: none;
        }

        a:hover {
            color: #2d2d2e;
            text-decoration-line: none;
        }

        a:active {
            color: black;
            text-decoration-line: none;
        }

        #select {
            font-weight: 800;
            border: 2px solid black;
            margin-right: 0.2em;
        }

        #warning {
            background-color: #73b7c9ff;
            font-size: 30px;
            text-align: center;
            padding: 20px;
        }

        .content {
            background-color: #73b7c955;
            padding: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
        }

        /* Close button */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <header>
        <br>
        <span><a href="home.html">Home</a></span>
        <span><a href="about.html">About</a></span>
        <span><a href="survey.html">Survey</a></span>
        <span id="select"><a href="quiz.html">Quiz</a></span>
    </header>
    <div class="parallax1">
        <div id="warning">
            <centre> This quiz is specially designed for students to test if they are dyslexic or not. Students are
                advised to attempt all the questions patiently under the surveillance of an elder.<br>
                ALL THE BEST JUNIOR!</centre>
        </div>
    </div>
    <div class="main">
        <div name="quiz">
            <div class="question">
                <span id="question">
                    Question 1
                </span><br><br>
                <div class="content">
                    Check whether these two alphabets are same or not?<br><br>
                    <img src="o.png" width=100 height=100><img src="0.jpeg" width=100 height=100><br>
                    <input type="radio" id="Yes" name="q1" value="4" >
                    <label for="Yes">Yes</label><br>
                    <input type="radio" id="No" name="q1" value="0" >
                    <label for="No">No</label><br>
                </div>
                <br>

                <span id="question">
                    Question 2
                </span><br><br>
                <div class="content">
                    Guess the fruit in the picture below.<br><br>
                    <img src="grapes.jpeg" width=350 height=250><br>
                    <input type="radio" id="Grapes" name="q2" value="4">
                    <label for="Grapes">Grapes</label><br>
                    <input type="radio" id="Orange" name="q2" value="0"  
>
                    <label for="Orange">Orange</label><br>
                    <input type="radio" id="Banana" name="q2" value="0"  >
                    <label for="Banana">Banana</label><br>
                    <input type="radio" id="Mango" name="q2" value="0"  >
                    <label for="Mango">Mango</label><br>
                </div>
                <br>

                <span id="question">
                    Question 3
                </span><br><br>
                <div class="content">
                    Check whether these two alphabets are same or not?<br><br>
                    <img src="g.jpg" width=100 height=100><img src="s.jpeg" width=100 height=100><br>
                    <input type="radio" id="Yes" name="q3" value="0"  >
                    <label for="Yes">Yes</label><br>
                    <input type="radio" id="No" name="q3" value="4"  >
                    <label for="No">No</label><br>
                </div>
                <br>

                <span id="question">
                    Question 4
                </span><br><br>
                <div class="content">
                    Which letter is G?<br><br>
                    <img src="g.jpg" width=100 height=100><img src="o.png" width=100 height=100><br>
                    <input type="radio" id="First" name="q4" value="4"  >
                    <label for="First">First</label><br>
                    <input type="radio" id="Second" name="q4" value="0"  >
                    <label for="Second">Second</label><br>
                </div>
                <br>

                <span id="question">
                    Question 5
                </span><br><br>
                <div class="content">
                    Which letter CAT starts with?<br><br>
                    <img src="cat.jpeg" width=400 height=300><br>
                    <input type="radio" id="K" name="q5" value="0"  >
                    <label for="K">K</label><br>
                    <input type="radio" id="S" name="q5" value="0"  >
                    <label for="S">S</label><br>
                    <input type="radio" id="C" name="q5" value="4"  >
                    <label for="C">C</label><br>
                </div>
                <br>

                <span id="question">
                    Question 6
                </span><br><br>
                <div class="content">
                    What is the smaller version of this letter?<br><br>
                    <img src="b.png" width=100 height=100><br>
                    <input type="radio" id="d" name="q6" value="0"  >
                    <label for="d">d</label><br>
                    <input type="radio" id="b" name="q6" value="4"  >
                    <label for="b">b</label><br>
                </div>
                <br>

                <span id="question">
                    Question 7
                </span><br><br>
                <div class="content">
                    What do you hear?<br><br>
                    <audio controls>
                        <source src="s.mp3" type="audio/mp3">
                    </audio><br><br>
                    <input type="radio" id="F" name="q7" value="0"  >
                    <label for="F">F</label><br>
                    <input type="radio" id="S" name="q7" value="4"  >
                    <label for="S">S</label><br>
                </div>
                <br>

                <span id="question">
                    Question 8
                </span><br><br>
                <div class="content">
                    What do you see in the picture?<br><br>
                    <img src="god.jpeg" width=300 height=200><br><br>
                    <input type="radio" id="DOG" name="q8" value="0"  >
                    <label for="DOG">DOG</label><br>
                    <input type="radio" id="GOD" name="q8" value="4"  >
                    <label for="GOD">GOD</label><br>
                </div>
                <br>

                <span id="question">
                    Question 9
                </span><br><br>
                <div class="content">
                    Which hand is left and Which hand is right?<br><br>
                    <img src="right.jpeg" width=300 height=200><img src="left.jpeg" width=300 height=200><br><br>
                    <input type="radio" id="First one is right and next one is left" name="q9" value="4"  >
                    <label for="First one is right and next one is left">First one is right and next one is
                        left</label><br>
                    <input type="radio" id="First one is left and next one is right" name="q9" value="0"  >
                    <label for="First one is left and next one is right">First one is left and next one is
                        right</label><br>
                </div>
                <br>

                <span id="question">
                    Question 10
                </span><br><br>
                <div class="content">
                    What do you hear?<br><br>
                    <audio controls>
                        <source src="lake.mp3" type="audio/mp3">
                    </audio><br><br>
                    <input type="radio" id="CAKE" name="q10" value="0"  >
                    <label for="CAKE">CAKE</label><br>
                    <input type="radio" id="LAKE" name="q10" value="4"  >
                    <label for="LAKE">LAKE</label><br>
                    <input type="radio" id="TAKE" name="q10" value="0"  >
                    <label for="TAKE">TAKE</label><br>
                    <input type="radio" id="FAKE" name="q10" value="0"  >
                    <label for="FAKE">FAKE</label><br>
                </div>
                <br>
            
            <span id="button"><button onclick="handleSurveySubmit()"><centre>SUBMIT THE QUIZ!</centre></button></span>
            </div>
        </div>
    </div>
    <div id="myModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
          <span class="close">&times;</span>
          <p id="modal-content"></p>
        </div>
      </div>
    <div class="footer">
        2021 WEBpredictor<br>
        All rights reserved<br>
        Issued in public interest<br>
        WEBpredictor does not provide any medical advice, diagnosis or treatment.<br>
    </div>

</body>

<script>
    
    var modal = document.getElementById("myModal");
    var modalContent = document.getElementById("modal-content")
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
    }
    }

    function validateSurveyData(surveyData) {
        for (var question in surveyData) {
            if (surveyData[question] === undefined) {
                alert('Please answer all questions before submitting the survey.');
                return false;
            }
        }
        return true;
    }

    function calculateSurveyData(quizData) {
        const data = {
            lang_vocab : 0,
            memory : 0,
            speed : 0,
            visual : 0,
            audio : 0,
            survey : 0
        };
        const {
            q1,
            q2,
            q3,
            q4,
            q5,
            q6,
            q7,
            q8,
            q9,
            q10,
        } = quizData;

        data.lang_vocab = (parseInt(q1) + parseInt(q2) + parseInt(q3) + parseInt(q4) + parseInt(q5) + parseInt(q6) + parseInt(q8))/28;
        data.memory = (parseInt(q2) + parseInt(q9))/16;
        data.speed = 0.9;
        data.visual = (parseInt(q1) + parseInt(q3)+parseInt(q4) + parseInt(q6))/12;
        data.audio = (parseInt(q7) + parseInt(q10)) / 8;
        data.survey = (localStorage.getItem('surveyScores') || 80)/80;
        return data;
    }

    async function submitquizData(data) {
        const response = await fetch('http://localhost:5000/predict', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });
        return response.json();
    }

    // Function to handle survey submission
    async function handleSurveySubmit() {
        console.log('Running Submit Function')
        // Object to store question IDs and values
        var quizData = {
            q1: document.querySelector('input[name="q1"]:checked')?.value,
            q2: document.querySelector('input[name="q2"]:checked')?.value,
            q3: document.querySelector('input[name="q3"]:checked')?.value,
            q4: document.querySelector('input[name="q4"]:checked')?.value,
            q5: document.querySelector('input[name="q5"]:checked')?.value,
            q6: document.querySelector('input[name="q6"]:checked')?.value,
            q7: document.querySelector('input[name="q7"]:checked')?.value,
            q8: document.querySelector('input[name="q8"]:checked')?.value,
            q9: document.querySelector('input[name="q9"]:checked')?.value,
            q10: document.querySelector('input[name="q10"]:checked')?.value,
        };

        console.log(quizData);
        const isDataValid = validateSurveyData(quizData);

        if (isDataValid) {
            const data = calculateSurveyData(quizData);
            const res = await submitquizData(data);
            console.log(res);
            // alert(res?.result);
            modal.style.display = "block";
            modalContent.innerHTML = res?.result;
        }
    }
</script>
</html>